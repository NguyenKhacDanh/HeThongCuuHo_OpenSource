@model RescueHub.ViewModels.Public.CreateUserRequestViewModel
@{
    ViewData["Title"] = "Y√™u c·∫ßu c·ª©u h·ªô kh·∫©n c·∫•p";
}

<h2 class="mb-3">üö® Y√™u c·∫ßu c·ª©u h·ªô kh·∫©n c·∫•p</h2>

<div class="alert alert-warning">
    H√£y b√¨nh tƒ©nh, cung c·∫•p th√¥ng tin ch√≠nh x√°c nh·∫•t c√≥ th·ªÉ. H·ªá th·ªëng s·∫Ω g·ª≠i y√™u c·∫ßu t·ªõi ƒë·ªôi c·ª©u h·ªô g·∫ßn nh·∫•t.
</div>

<form asp-action="RequestHelp" method="post" enctype="multipart/form-data" class="row g-3">
    <div class="col-md-6">
        <label class="form-label">H·ªç v√† t√™n *</label>
        <input asp-for="FullName" class="form-control" />
        <span asp-validation-for="FullName" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
        <input asp-for="PhoneNumber" class="form-control" />
        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label class="form-label">S·ªë ng∆∞·ªùi c·∫ßn c·ª©u</label>
        <input asp-for="PeopleCount" class="form-control" type="number" min="1" />
    </div>
    <div class="col-md-4">
        <label class="form-label">M·ª±c n∆∞·ªõc ∆∞·ªõc l∆∞·ª£ng (cm)</label>
        <input asp-for="WaterLevel" class="form-control" type="number" min="0" />
    </div>
    <div class="col-md-4">
        <label class="form-label">·∫¢nh hi·ªán tr∆∞·ªùng (n·∫øu c√≥)</label>
        <input asp-for="IncidentImage" type="file" class="form-control" />
    </div>

    <div class="col-12">
        <label class="form-label">ƒê·ªãa ch·ªâ m√¥ t·∫£ (n·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c GPS)</label>
        <textarea asp-for="AddressText" class="form-control" rows="2"></textarea>
    </div>

    <div class="col-md-6">
        <label class="form-label">T·ªça ƒë·ªô GPS</label>
        <div class="input-group mb-2">
            <span class="input-group-text">Lat</span>
            <input asp-for="Latitude" class="form-control" />
            <span class="input-group-text">Lng</span>
            <input asp-for="Longitude" class="form-control" />
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="getLocation()">üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i</button>
    </div>

    <div class="col-md-6" id="miniMapContainer" style="height: 250px; display:none;">
        <div id="miniMap" style="height: 100%;"></div>
    </div>

    <div class="col-12">
        <label class="form-label">Th√¥ng tin ƒë·ªëi t∆∞·ª£ng d·ªÖ b·ªã t·ªïn th∆∞∆°ng</label>
        <div class="form-check">
            <input asp-for="HasChildren" class="form-check-input" />
            <label class="form-check-label">C√≥ tr·∫ª em</label>
        </div>
        <div class="form-check">
            <input asp-for="HasElderly" class="form-check-input" />
            <label class="form-check-label">C√≥ ng∆∞·ªùi gi√†</label>
        </div>
        <div class="form-check">
            <input asp-for="HasPregnantWoman" class="form-check-input" />
            <label class="form-check-label">C√≥ ph·ª• n·ªØ mang thai</label>
        </div>
        <div class="form-check">
            <input asp-for="HasDisabledPerson" class="form-check-input" />
            <label class="form-check-label">C√≥ ng∆∞·ªùi khuy·∫øt t·∫≠t</label>
        </div>
        <div class="form-check">
            <input asp-for="NeedMedicalSupport" class="form-check-input" />
            <label class="form-check-label">C·∫ßn h·ªó tr·ª£ y t·∫ø kh·∫©n c·∫•p</label>
        </div>
    </div>

    <div class="col-12">
        <label class="form-label">M√¥ t·∫£ chi ti·∫øt t√¨nh hu·ªëng</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
    </div>

    <div class="col-12">
        <button type="submit" class="btn btn-danger btn-lg">G·ª≠i y√™u c·∫ßu</button>
    </div>
</form>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        function getLocation() {
            if (!navigator.geolocation) {
                alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS.");
                return;
            }
            navigator.geolocation.getCurrentPosition(function (pos) {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                document.getElementById("Latitude").value = lat;
                document.getElementById("Longitude").value = lng;

                const container = document.getElementById("miniMapContainer");
                container.style.display = "block";

                const map = L.map('miniMap').setView([lat, lng], 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19
                }).addTo(map);
                L.marker([lat, lng]).addTo(map).bindPopup("V·ªã tr√≠ c·ªßa b·∫°n").openPopup();
            }, function (err) {
                alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠: " + err.message);
            });
        }
    </script>
}
